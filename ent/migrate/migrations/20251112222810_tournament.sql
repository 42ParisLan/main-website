-- Create "tournaments" table
CREATE TABLE "tournaments" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "slug" character varying NOT NULL,
  "name" character varying NOT NULL,
  "description" character varying NOT NULL,
  "is_visible" boolean NOT NULL DEFAULT false,
  "registration_start" timestamptz NOT NULL,
  "registration_end" timestamptz NOT NULL,
  "tournament_start" timestamptz NOT NULL,
  "tournament_end" timestamptz NOT NULL,
  "state" character varying NOT NULL DEFAULT 'DRAFT',
  "max_teams" bigint NOT NULL,
  "team_structure" jsonb NULL,
  "custom_page_component" character varying NULL,
  "external_link" character varying NULL,
  "results" jsonb NULL,
  "created_at" timestamptz NOT NULL,
  "user_created_tournaments" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "tournaments_users_created_tournaments" FOREIGN KEY ("user_created_tournaments") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create index "tournaments_slug_key" to table: "tournaments"
CREATE UNIQUE INDEX "tournaments_slug_key" ON "tournaments" ("slug");
-- Create "rank_groups" table
CREATE TABLE "rank_groups" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "name" character varying NOT NULL,
  "rank_min" bigint NOT NULL,
  "rank_max" bigint NOT NULL,
  "tournament_rank_groups" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "rank_groups_tournaments_rank_groups" FOREIGN KEY ("tournament_rank_groups") REFERENCES "tournaments" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create "teams" table
CREATE TABLE "teams" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "name" character varying NOT NULL,
  "image_url" character varying NULL,
  "status" character varying NOT NULL DEFAULT 'DRAFT',
  "is_locked" boolean NOT NULL DEFAULT false,
  "queue_position" bigint NULL,
  "score" bigint NULL,
  "created_at" timestamptz NOT NULL,
  "team_rank_group" bigint NULL,
  "tournament_teams" bigint NOT NULL,
  "user_created_teams" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "teams_rank_groups_rank_group" FOREIGN KEY ("team_rank_group") REFERENCES "rank_groups" ("id") ON UPDATE NO ACTION ON DELETE SET NULL,
  CONSTRAINT "teams_tournaments_teams" FOREIGN KEY ("tournament_teams") REFERENCES "tournaments" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT "teams_users_created_teams" FOREIGN KEY ("user_created_teams") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create "invitations" table
CREATE TABLE "invitations" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "status" character varying NOT NULL DEFAULT 'PENDING',
  "created_at" timestamptz NOT NULL,
  "expires_at" timestamptz NULL,
  "message" character varying NULL,
  "team_invitations" bigint NOT NULL,
  "user_received_invitations" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "invitations_teams_invitations" FOREIGN KEY ("team_invitations") REFERENCES "teams" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT "invitations_users_received_invitations" FOREIGN KEY ("user_received_invitations") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create "team_members" table
CREATE TABLE "team_members" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "role" character varying NOT NULL,
  "team_members" bigint NOT NULL,
  "user_team_memberships" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "team_members_teams_members" FOREIGN KEY ("team_members") REFERENCES "teams" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT "team_members_users_team_memberships" FOREIGN KEY ("user_team_memberships") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
-- Create "tournament_admins" table
CREATE TABLE "tournament_admins" (
  "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  "role" character varying NOT NULL DEFAULT 'ADMIN',
  "tournament_admins" bigint NOT NULL,
  "user_tournament_admin_roles" bigint NOT NULL,
  PRIMARY KEY ("id"),
  CONSTRAINT "tournament_admins_tournaments_admins" FOREIGN KEY ("tournament_admins") REFERENCES "tournaments" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
  CONSTRAINT "tournament_admins_users_tournament_admin_roles" FOREIGN KEY ("user_tournament_admin_roles") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);
